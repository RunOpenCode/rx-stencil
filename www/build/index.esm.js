import{g as e,f as t}from"./p-8411601b.js";import{S as n,o as r,c as o,i,e as u,a as l,b as f,f as c,p as d,d as a,n as _,O as v,g as h,h as w}from"./p-0cd0b2da.js";export{j as propertyObservable,s as setProperty}from"./p-0cd0b2da.js";const p={now(){return(p.delegate||Date).now()},delegate:undefined};class b extends n{constructor(e=Infinity,t=Infinity,n=p){super();this._bufferSize=e;this._windowTime=t;this._timestampProvider=n;this._buffer=[];this._infiniteTimeWindow=true;this._infiniteTimeWindow=t===Infinity;this._bufferSize=Math.max(1,e);this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:n,_infiniteTimeWindow:r,_timestampProvider:o,_windowTime:i}=this;if(!t){n.push(e);!r&&n.push(o.now()+i)}this._trimBuffer();super.next(e)}_subscribe(e){this._throwIfClosed();this._trimBuffer();const t=this._innerSubscribe(e);const{_infiniteTimeWindow:n,_buffer:r}=this;const o=r.slice();for(let t=0;t<o.length&&!e.closed;t+=n?1:2){e.next(o[t])}this._checkFinalizedStatuses(e);return t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:n,_infiniteTimeWindow:r}=this;const o=(r?1:2)*e;e<Infinity&&o<n.length&&n.splice(0,n.length-o);if(!r){const e=t.now();let r=0;for(let t=1;t<n.length&&n[t]<=e;t+=2){r=t}r&&n.splice(0,r+1)}}}function m(e,t){return r(((n,r)=>{let i=0;n.subscribe(o(r,(n=>{r.next(e.call(t,n,i++))})))}))}function y(e,t,n,r,s,l,f,c){const d=[];let a=0;let _=0;let v=false;const h=()=>{if(v&&!d.length&&!a){t.complete()}};const w=e=>a<r?p(e):d.push(e);const p=e=>{l&&t.next(e);a++;let c=false;i(n(e,_++)).subscribe(o(t,(e=>{s===null||s===void 0?void 0:s(e);if(l){w(e)}else{t.next(e)}}),(()=>{c=true}),undefined,(()=>{if(c){try{a--;while(d.length&&a<r){const e=d.shift();if(f){u(t,f,(()=>p(e)))}else{p(e)}}h()}catch(e){t.error(e)}}})))};e.subscribe(o(t,w,(()=>{v=true;h()})));return()=>{c===null||c===void 0?void 0:c()}}function O(e,t,n=Infinity){if(l(t)){return O(((n,r)=>m(((e,o)=>t(n,e,r,o)))(i(e(n,r)))),n)}else if(typeof t==="number"){n=t}return r(((t,r)=>y(t,r,e,n)))}function $(e=Infinity){return O(f,e)}function C(){return $(1)}function x(...e){return C()(c(e,d(e)))}function I(e,t){return r(((n,r)=>{let i=0;n.subscribe(o(r,(n=>e.call(t,n,i++)&&r.next(n))))}))}function E(e={}){const{connector:t=(()=>new n),resetOnError:o=true,resetOnComplete:s=true,resetOnRefCountZero:u=true}=e;return e=>{let n;let l;let f;let c=0;let d=false;let _=false;const v=()=>{l===null||l===void 0?void 0:l.unsubscribe();l=undefined};const h=()=>{v();n=f=undefined;d=_=false};const w=()=>{const e=n;h();e===null||e===void 0?void 0:e.unsubscribe()};return r(((e,r)=>{c++;if(!_&&!d){v()}const p=f=f!==null&&f!==void 0?f:t();r.add((()=>{c--;if(c===0&&!_&&!d){l=P(w,u)}}));p.subscribe(r);if(!n&&c>0){n=new a({next:e=>p.next(e),error:e=>{_=true;v();l=P(h,o,e);p.error(e)},complete:()=>{d=true;v();l=P(h,s);p.complete()}});i(e).subscribe(n)}}))(e)}}function P(e,t,...n){if(t===true){e();return}if(t===false){return}const r=new a({next:()=>{r.unsubscribe();e()}});return i(t(...n)).subscribe(r)}function M(e,t,n){let r;let o=false;if(e&&typeof e==="object"){({bufferSize:r=Infinity,windowTime:t=Infinity,refCount:o=false,scheduler:n}=e)}else{r=e!==null&&e!==void 0?e:Infinity}return E({connector:()=>new b(r,t,n),resetOnError:true,resetOnComplete:false,resetOnRefCountZero:o})}function g(...e){const t=d(e);return r(((n,r)=>{(t?x(e,n,t):x(e,n)).subscribe(r)}))}function T(e){return r(((t,n)=>{i(e).subscribe(o(n,(()=>n.complete()),_));!n.closed&&t.subscribe(n)}))}function S(e,t,n){const i=l(e)||t||n?{next:e,error:t,complete:n}:e;return i?r(((e,t)=>{var n;(n=i.subscribe)===null||n===void 0?void 0:n.call(i);let r=true;e.subscribe(o(t,(e=>{var n;(n=i.next)===null||n===void 0?void 0:n.call(i,e);t.next(e)}),(()=>{var e;r=false;(e=i.complete)===null||e===void 0?void 0:e.call(i);t.complete()}),(e=>{var n;r=false;(n=i.error)===null||n===void 0?void 0:n.call(i,e);t.error(e)}),(()=>{var e,t;if(r){(e=i.unsubscribe)===null||e===void 0?void 0:e.call(i)}(t=i.finalize)===null||t===void 0?void 0:t.call(i)})))})):f}function W(e,t){return new v((n=>{let r=new MutationObserver((e=>{n.next(e)}));r.observe(e,t);return()=>{r.disconnect()}}))}function L(e){if("function"!==typeof e.render){throw new Error("Component does not have a render function.")}return new v((t=>{let n=e.render;e.render=function(){Promise.resolve().then((()=>{t.next()}));return n.call(this)};return()=>{e.render=n}}))}function k(e){return W(e,{subtree:true,childList:true}).pipe(I((e=>{for(let t=0;t<e.length;t++){if("childList"!==e[t].type){continue}if(e[t].addedNodes.length||e[t].removedNodes.length){return true}}return false})),m((()=>{})))}function q(t,n){return(r,o)=>{let i={set:function(){throw new Error(`Property "${o}" is read-only.`)},get:function(){let r=`__rx__query_selector__observable__shadow_root__${(n===null||n===void 0?void 0:n.shadowRoot)?"yes":"no"}__mutation_observer__${(n===null||n===void 0?void 0:n.mutationObserver)?"yes":"no"}__selector__${t}__`;if(!this[r]){let o=(n===null||n===void 0?void 0:n.shadowRoot)?e(this).shadowRoot:e(this);let i=(n===null||n===void 0?void 0:n.mutationObserver)?k(o):L(this);this[r]=i.pipe(g(),m((()=>o.querySelector(t))),h(),M(1))}return this[r]}};Object.defineProperty(r,o,i)}}function z(t,n){return(r,o)=>{let i={set:function(){throw new Error(`Property "${o}" is read-only.`)},get:function(){let r=`__rx__query_selector_all__observable__shadow_root__${(n===null||n===void 0?void 0:n.shadowRoot)?"yes":"no"}__mutation_observer__${(n===null||n===void 0?void 0:n.mutationObserver)?"yes":"no"}__selector__${t}__`;if(!this[r]){let o=(n===null||n===void 0?void 0:n.shadowRoot)?e(this).shadowRoot:e(this);let i=(n===null||n===void 0?void 0:n.mutationObserver)?k(o):L(this);this[r]=i.pipe(g(),m((()=>Array.from(o.querySelectorAll(t)))),h(((e,t)=>{if(e.length!==t.length){return false}for(let n=0;n<e.length;n++){if(e[n]!==t[n]){return false}}return true})),M(1))}return this[r]}};Object.defineProperty(r,o,i)}}function A(e,n=true){return r=>r.pipe(S((()=>{if(!n){t(e);return}Promise.resolve().then((()=>t(e)))})))}function D(e,t){w(e,t);return n=>n.pipe(S((n=>{e[t]=n})))}let R=new WeakMap;let Z=function(e){let t=e.disconnectedCallback;if(!t){throw new Error(`Component "${e.constructor.name}" does not have a "disconnectedCallback()" method defined.`)}let r=new n;e.disconnectedCallback=function(){if(t){t.call(e)}r.next()};return r.asObservable()};let B=function(t){let n=e(t);if(null===n.parentNode){throw new Error(`Component "${t.constructor.name}" is not within DOM.`)}return new v((e=>{let r=new MutationObserver((t=>{t.forEach((t=>{for(let r of Array.from(t.removedNodes)){if(r!==n){continue}e.next();e.complete()}}))}));r.observe(n.parentNode,{childList:true,subtree:true});return()=>{r.disconnect();R.delete(t)}}))};function F(e){let t=[Z,B];for(let n of t){try{R.set(e,n(e));return}catch(e){}}throw new Error(`Could not create disconnect observable for component "${e.constructor.name}".`)}function G(e){return t=>{if(!R.has(e)){F(e)}let n=R.get(e);return t.pipe(T(n))}}export{q as QuerySelector,z as QuerySelectorAll,W as mutationObservable,L as renderObservable,A as scheduleRender,D as toProperty,G as untilDisconnected};
//# sourceMappingURL=index.esm.js.map